/* globules.io MongOGX 1.2.5.4 */  
var OGX;void 0===OGX&&(OGX={}),OGX.MongogxCollection=class{constructor(e,t){this.name=e,this.data=t,this._initDocuments()}get collection(){var e,t=[];for(e in this.data)t.push(this.data);return t}insert(){return 0<arguments.length?this.insertMany.apply(null,arguments):this.insertOne(arguments[0])}insertOne(e){if(e.hasOwnProperty("_id")){if(!this._isMongoId(e._id))return!1}else e._id=this._genMongoId();return(this.data[e._id]=e)._id}insertMany(){var e,t,a=[];for(t in arguments)e=insertOne(t),a.push(e);return a}update(e,t){return this.updateOne(e,t)}updateOne(e,t){e=this.find(e,1);return!!e&&this._update(e,t)}updateMany(){var e=this.find(__query);return!!e&&this._update(e,__update)}replaceOne(e,t){t._id=this._genMongoId();e=this.find(e,1);if(e)for(var a in e)return this.data[t._id]=t,delete this.data[a],!0;return!1}deleteOne(e){e=this.find(e,1);if(e)for(var t in e)return delete this.data[t],!0;return!1}deleteMany(e){let t=0;e=this.find(e);if(e)for(var a in e)delete this.data[a],t++;return t}remove(){return this.data={},!0}find(t,e){void 0===e&&(e=0);let a,r,i,s;var o,n,d={};let p=0,h=this.data;for(o in t.hasOwnProperty("_id")&&this._isMongoId(t._id)&&this.data.hasOwnProperty(t._id)&&((h={})[t._id]=this.data[t._id]),h){for(var l in a=!0,s=!1,t){if("object"!=typeof t[l]&&(n={},n={$eq:t[l]},t[l]=n),i=h[o],1<(r=l.split(".")).length)for(;0<r.length;){if(!i.hasOwnProperty(r[0])){a=!1;break}if(a&&(i=i[r[0]],r.shift(),Array.isArray(i)))if(isNaN(Number(r[0]))){if(0!==r.length){for(let e=0;e<i.length;e++)if(a=this._handleOp(i[e][r[0]],t[l])){s=!0;break}break}if(a=this._handleOp(i,t[l])){s=!0;break}}else i=i[r[0]],r.shift();if(!a)break}else i.hasOwnProperty(l)?i=i[l]:a=!1;if(a&&!s&&!(a=this._handleOp(i,t[l])))break}if(a&&(d[o]=h[o],p++,0<e)&&e===p)return d}return d}findOne(e){return this.find(e,1)}toJSON(){var e,t=[];for(e in this.data)t.push(this.data[e]);return t}_handleOp(r,i){let s=!0;if("object"!=typeof i)return r===i;for(var o in i){if("$"===o.substr(0,1))switch(o.substr(1)){case"eq":s=r===i[o];break;case"neq":s=r!==i[o];break;case"gt":s=r>i[o];break;case"gte":s=r>=i[o];break;case"lt":s=r<i[o];break;case"lte":s=r<=i[o];break;case"in":if(Array.isArray(i[o]))for(let e=0;e<i[o].length&&!(s=-1!==r.indexOf(i[o][e]));e++);else s=-1!==r.indexOf(i[o]);break;case"text":s=-1!==r.indexOf(i[o]);break;case"nin":if(Array.isArray(i[o]))for(let e=0;e<i[o].length&&(s=-1===r.indexOf(i[o][e]));e++);else s=-1===r.indexOf(i[o]);break;case"regex":"string"==typeof i[o]&&(i[o]=new RegExp(i[o])),s=r.match(i[o]);break;case"mod":s=r%i[o][0]===i[o][1];break;case"all":if(Array.isArray(i[o])&&Array.isArray(r)){let a;s=!0;for(let t=0;t<i[o].length;t++){a=!1;for(let e=0;e<r.length;e++)if(i[o][t]===r[e]){a=!0;break}if(!a){s=!1;break}}}break;case"size":s=i[o].length==r.length}if(!s)break}return s}_update(__collection,__update){let match=0;for(var _id in __collection){let oper,ev,ev2,pre,pro,val;for(var op in __update)if("object"!=typeof __update[op]&&(__update={$set:__update},op="$set"),"$"===op.substr(0,1))for(var prop in oper=op.substr(1),__update[op])switch(oper){case"set":val=__update[op][prop],"string"==typeof val&&(val="'"+val+"'"),ev=eval("this.data[_id]."+prop+"="+val),void 0!==ev&&match++;break;case"unset":ev=eval("delete this.data[_id]."+prop),void 0!==ev&&match++;break;case"inc":ev=eval("this.data[_id]."+prop+"+="+__update[op][prop]),void 0!==ev&&match++;break;case"min":ev=eval("this.data[_id]."+prop),void 0!==ev&&ev>__update[op][prop]&&(ev=eval("this.data[_id]."+prop+"="+__update[op][prop]),void 0!==ev)&&match++;case"max":ev=eval("this.data[_id]."+prop),void 0!==ev&&ev<__update[op][prop]&&(ev=eval("this.data[_id]."+prop+"="+__update[op][prop]),void 0!==ev)&&match++;break;case"mul":ev=eval("this.data[_id]."+prop+"*="+__update[op][prop]),void 0!==ev&&match++;break;case"rename":let pos=prop.lastIndexOf(".");pro=-1===pos?(pre="",prop):(pre=prop.substr(0,pos+1),prop.split(".").pop()),ev=eval("this.data[_id]."+pre+__update[op][prop]+"=this.data[_id]."+pre+pro),ev2=eval("delete this.data[_id]."+pre+pro),void 0!==ev&&match++}}return match}_initDocuments(){var e,t={};for(e in this.data)t[this.data[e]._id]=this.data[e];this.data=t}_genMongoId(){let e=Math.floor((new Date).getTime()/1e3).toString(16);for(;e.length<24;)e+=Math.floor(10*Math.random()).toString();return e}_isMongoId(e){return"string"==typeof e&&e.match(/[a-z0-9]{24}/g)}};var OGX;(OGX=void 0===OGX?{}:OGX).Mongogx=class{constructor(t,e,i){this.data_default={db:{mongogx:{}}},this.database=null,this.data=null,this.options=null;var a,s={storage:OGX.Mongogx.LOCAL_STORAGE,write_concern:{mode:OGX.Mongogx.WRITE_DIRECT,delay:5},encryption:!1,format:OGX.Mongogx.FORMAT_ARRAY,callback:function(){}};for(a in void 0===i&&(i={}),s)i.hasOwnProperty(a)||(i[a]=s[a]);this.options=i,this._loadData(t,e)}static get LOCAL_STORAGE(){return"localStorage"}static get SESSION_STORAGE(){return"sessionStorage"}static get APP_STORAGE(){return"appStorage"}static get WRITE_DIRECT(){return"writeDirect"}static get ENCRYPTION_AES(){return"AES"}static get FORMAT_OBJECT(){return 0}static get FORMAT_ARRAY(){return 1}setDatabase(t){return!!this.data.db.hasOwnProperty(t)&&(this.database=t,!0)}getDatabases(){var t,e=[];for(t in this.data.db)e.push(t);return e}createDatabase(t){return!this.data.db.hasOwnProperty(t)&&(this.data.db[t]=new OGX.MongogxDatabase(t,{}),this._write(),!0)}deleteDatabase(t){return!!this.data.db.hasOwnProperty(t)&&(delete this.data.db[t],this._write(),!0)}setCollection(t){return!!this._dbSet()&&this.data.db[this.database].setCollection(t)}getCollection(t){return void 0===t&&this._isSet()&&(t=this.data.db[this.database].collection),!(!this._dbSet()||!this.data.db[this.database].hasCollection(t))&&this.data.db[this.database].getCollection(t).collection}createCollection(t){if(this._dbSet()){var e=this.data.db[this.database].createCollection(t);if(e)return this.data.db[this.database].collections[t]=e,!0}return!1}deleteCollection(t){return!!this.database&&!!(t=this.data.db[this.database].deleteCollection(t))&&(this._write(),t)}clearCollection(t){return!!this.database&&(this.data.db[this.database].clearCollection(t)?(this._write(),!0):void 0)}insert(){return 1<arguments.length?this.insertMany.apply(null,arguments):this.insertOne(arguments[0])}insertOne(t){if(this._isSet()){t=this.data.db[this.database].getCollection().insertOne(t);if(t)return this._write(),t}return!1}insertMany(){if(this._isSet()){var t=this.data.db[this.database].getCollection().insertMany.apply(null,parameters);if(t)return this._write(),t}return!1}update(t,e){if(this._isSet()){t=this.data.db[this.database].getCollection().update(t,e);if(t)return this._write(),t}return!1}updateOne(t,e){if(this._isSet()){t=this.data.db[this.database].getCollection().updateOne(t,e);if(t)return this._write(),t}return!1}updateMany(t,e){if(this._isSet()){t=this.data.db[this.database].getCollection().updateMany(t,e);if(t)return this._write(),t}return!1}replaceOne(t,e){if(this._isSet()){t=this.data.db[this.database].getCollection().replaceOne(t,e);if(t)return this._write(),t}return!1}deleteOne(t){if(this._isSet()){t=this.data.db[this.database].getCollection().deleteOne(t);if(t)return this._write(),t}return!1}deleteMany(t){if(this._isSet()){t=this.data.db[this.database].getCollection().deleteMany(t);if(t)return this._write(),t}return!1}find(e,i){if(this._isSet()){let t=this.data.db[this.database].getCollection().find(e,i);return t=this.options.format?this._objToArr(t):t}return!1}findOne(t){if(this._isSet()){t=this.data.db[this.database].getCollection().findOne(t);if(this.options.format)return this._objToArr(t)[0]}return!1}_objToArr(t){var e,i=[];for(e in t)t.hasOwnProperty(e)&&i.push(t[e]);return i}_getStorage(t){let e;switch(t){case OGX.Mongogx.LOCAL_STORAGE:e=localStorage;break;case OGX.Mongogx.SESSION_STORAGE:e=sessionStorage}return e}_loadData(e,i){let a=this;switch(this.options.storage){case OGX.Mongogx.APP_STORAGE:this._readFile("mongogx.data",function(t){a.options.encryption&&(t=a._decrypt(t)),a.data=JSON.parse(t),a._write(),a._initDatabases(e,i)});break;case OGX.Mongogx.LOCAL_STORAGE:case OGX.Mongogx.SESSION_STORAGE:let t=this._getStorage(this.options.storage).getItem("mongogx");t?(a.options.encryption&&(t=a._decrypt(t)),this.data=JSON.parse(t)):(this.data=JSON.parse(JSON.stringify(this.data_default)),this._write()),this._initDatabases(e,i)}}_initDatabases(t,e){for(var i in this.data.db)this.data.db[i]=new OGX.MongogxDatabase(i,this.data.db[i]);void 0!==t&&t&&(this.data.db.hasOwnProperty(t)||this.createDatabase(t),this.setDatabase(t),void 0!==e)&&(this.getCollection(e)||this.createCollection(e),this.setCollection(e)),this.options.storage===OGX.Mongogx.APP_STORAGE&&this.options.callback()}_write(){let e=this,i=JSON.stringify(e.data);switch(this.options.encryption&&(i=this._encrypt(i)),this.options.storage){case OGX.Mongogx.APP_STORAGE:setTimeout(function(){e._writeFile("mongogx.data",i)},e.options.write_concern.delay);break;case OGX.Mongogx.LOCAL_STORAGE:case OGX.Mongogx.SESSION_STORAGE:let t=this._getStorage(this.options.storage);setTimeout(function(){t.setItem("mongogx",i)},e.options.write_concern.delay)}}_encrypt(t){if(this.options.encryption.scheme===OGX.Mongogx.ENCRYPTION_AES)return this._encryptAES(t)}_encryptAES(t){return CryptoJS.AES.encrypt(t,this.options.encryption.key,{mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}).toString()}_decrypt(t){if(this.options.encryption.scheme===OGX.Mongogx.ENCRYPTION_AES)return this._decryptAES(t)}_decryptAES(t){return CryptoJS.AES.decrypt(t,this.options.encryption.key,{mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}).toString(CryptoJS.enc.Utf8)}_dbSet(){return this.database&&this.data.db.hasOwnProperty(this.database)}_isSet(){return this._dbSet()&&null!==this.data.db[this.database].collection}_writeFile(e,i,a){this.options.encryption&&(i=this._encrypt(i)),window.resolveLocalFileSystemURL(cordova.file.dataDirectory,function(t){t.getFile(e,{create:!0},function(t){t.createWriter(function(t){var e=new Blob([i],{type:"text/plain"});t.write(e),void 0!==a&&a()})})})}_readFile(t,i){let a=this;window.resolveLocalFileSystemURL(cordova.file.dataDirectory+t,function(t){t.file(function(t){var e=new FileReader;e.onloadend=function(){let t=this.result;a.options.encryption&&(t=a._decrypt(t)),i(t)},e.readAsText(t)})},()=>this._onReadFail())}_onReadFail(t){this.data=JSON.parse(JSON.stringify(this.data_default)),this._writeFile("mongogx.data",JSON.stringify(this.data)),this._initDatabases()}};var OGX;(OGX=void 0===OGX?{}:OGX).MongogxDatabase=class{constructor(o,t,l){this.name=o,this.collection=null,this.collections=t,this._initCollections(),void 0!==l&&this.setCollection(l)}setCollection(o){return!!this.collections.hasOwnProperty(o)&&(this.collection=o,!0)}getCollections(){var o,t=[];for(o in this.collections)t.push(o);return t}getCollection(o){return void 0===o&&this.collection&&(o=this.collection),!!this.collections.hasOwnProperty(o)&&this.collections[o]}createCollection(o){return!this.collections.hasOwnProperty(o)&&(this.collections[o]=new OGX.MongogxCollection(o,{}),this.collections[o])}deleteCollection(o){if(!this.collections.hasOwnProperty(o))return!1;delete this.collections[o]}clearCollection(o){return!!this.collections.hasOwnProperty(o)&&this.collections[o].remove()}hasCollection(o){return this.collections.hasOwnProperty(o)}_initCollections(){for(var o in this.collections)this.collections[o]=new OGX.MongogxCollection(o,this.collections[o])}toJSON(){return this.collections}};